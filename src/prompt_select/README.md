# Prompt Selection
The scripts in `prompt_select` form part of an initial prompting phase where a more systematised prompting was attempted. 

To run the generation pipeline with these prompts, please run (from root):
```
bash src/prompt_select/prompting.sh
```

To reproduce the analysis, please run (from root): 
```
bash src/prompt_select/analysis.sh
```
See also the section below for the [Analysis Results](#analysis-results).

## Models
The models that were used for prompting were the following: 
1. [stabilityai/StableBeluga-7B](https://huggingface.co/stabilityai/StableBeluga-7B) (referred to as `beluga7b`)
2. [meta-llama/Llama-2-13b-chat-hf](https://huggingface.co/meta-llama/Llama-2-13b-chat-hf) (referred to as `llama2_chat13b`)


## Prompts
### Task (Dataset) Prompts 
Task prompts were created for each dataset: 
<details>
<summary>dailydialog</summary>

1. "respond to the final sentence: "
2. "continue this dialog: "
3. "finish this dialog: "
4. "continue writing the next sentence in this: "
</details>

<details>
<summary>dailymail_cnn</summary>

1. "summarize the main points of this article: "
2. "create a summary of the news article: "
3. "write a short summarized text of the news article: "
4. "summarize this: "
5. "what are the important parts of this article?: "
6. "write highlights for this article: "
</details>

<details>
<summary>mrpc</summary>

1. "paraphrase this text: "
2. "generate a sentence with a similar meaning: "
3. paraphrase this: "
4. "make a sentence that means the same as this: "
</details>

<details>
<summary>stories</summary>

1. "continue the story: "
2. "write a small text based on this story: "
3. "complete the text: "
4. "complete the story: "
5. "finish the story: "
6. "Make a story based on this writing prompt: "
</details>

### System (Model) Prompts
Each model also had their seperate system prompt that was presented prior to the task prompts:
<details>
<summary>StableBeluga</summary>

You are StableBeluga, an AI that follows instructions extremely well. Help as much as you can. Remember, be safe, and don't do anything illegal.

</details>

<details>
<summary>Llama2 chat </summary>

You are an AI, but you do not deviate from the task prompt, and you do not engage in small talk. Never begin your response with 'Sure, here is my response:' or anything of the like. It is important that you finish without getting cut off.

</details>
<br>
That is, each prompt consisted of a system prompt, followed by a task prompt. The system prompt was kept constant.


## Workflow
For each prompt for the particular dataset, 100 examples were generated by both Llama2 chat (13b) and StableBeluga (7B). 

Low-level features `["doc_length", "n_tokens", "n_characters", "n_sentences"]` were extracted for each prompt for each model.  

Afterwards, PCA was run on these low-level features to get new PC components. See the `PCA` folder for those results.

To then investigate differences between model completions and human completions, euclidean distances were computed between the PC components of the human generation and each model generation (i.e., human-beluga, human-llama2_chat). See also [src/prompt_selection/distance.py](https://github.com/rbroc/echo/blob/main/src/prompt_selection/distance.py).

## Analysis Results
## Plotting
Interactive plots illustrate the distance scores and their corresponding completion by hovering over them:
1. [dailydialog](https://htmlpreview.github.io/?https://github.com/rbroc/echo/blob/main/results/prompt_select/distance/all_PC_jitterplots/interactive/dailydialog.html)
2. [dailymail_cnn](https://htmlpreview.github.io/?https://github.com/rbroc/echo/blob/main/results/prompt_select/distance/all_PC_jitterplots/interactive/dailymail_cnn.html)
3. [mrpc](https://htmlpreview.github.io/?https://github.com/rbroc/echo/blob/main/results/prompt_select/distance/all_PC_jitterplots/interactive/mrpc.html)
4. [stories](https://htmlpreview.github.io/?https://github.com/rbroc/echo/blob/main/results/prompt_select/distance/all_PC_jitterplots/interactive/stories.html)

Static plots can also be found in this [folder](https://github.com/rbroc/echo/tree/main/results/prompt_select/distance/all_PC_jitterplots/static).

## Medians
The medians of the distances were computed for each model, dataset and prompt number:

| dataset       | model          |   1.0 |   2.0 |   3.0 |   4.0 | 5.0   | 6.0   |
|---------------|----------------|-------|-------|-------|-------|-------|-------|
|               | beluga7b       |  0.35 |  0.48 |  0.38 |  0.24 |       |       |
| dailydialog   | llama2_chat13b |  1.18 |  1.42 |  1.45 |  1.07 |       |       |
|               | beluga7b       |  0.63 |  0.46 |  0.46 |  0.64 | 1.047 | 0.673 |
| dailymail_cnn | llama2_chat13b |  1.62 |  1.54 |  1.34 |  1.42 | 1.753 | 1.977 |
|               | beluga7b       |  0.04 |  0.04 |  0.04 |  0.04 |       |       |
| mrpc          | llama2_chat13b |  0.07 |  0.07 |  0.06 |  0.06 |       |       |
|               | beluga7b       |  2.76 |  2.87 |  4.46 |  2.96 | 3.26  | 3.022 |
| stories       | llama2_chat13b |  2.97 |  2.99 |  3.48 |  2.92 | 2.69  | 2.48  |

## Two lowest medians per MODEL, DATASET
We can also group the results in the two prompts that hold the lowest median per model and dataset: 
| dataset       | model          |   prompt |   median |
|---------------|----------------|----------|----------|
| dailydialog   | beluga7b       |        4 |    0.241 |
|               |                |        1 |    0.354 |
|               | llama2_chat13b |        4 |    1.069 |
|               |                |        1 |    1.181 |
| dailymail_cnn | beluga7b       |        2 |    0.456 |
|               |                |        3 |    0.462 |
|               | llama2_chat13b |        3 |    1.337 |
|               |                |        4 |    1.417 |
| mrpc          | beluga7b       |        1 |    0.039 |
|               |                |        4 |    0.04  |
|               | llama2_chat13b |        3 |    0.056 |
|               |                |        4 |    0.06  |
| stories       | beluga7b       |        1 |    2.763 |
|               |                |        2 |    2.87  |
|               | llama2_chat13b |        6 |    2.48  |
|               |                |        5 |    2.69  |